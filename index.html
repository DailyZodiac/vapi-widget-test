<vapi-widget
  public-key="23ec6d15-2e34-4eab-a53f-37caa2df2bc9"
  assistant-id="2a6efbda-d66c-48f3-acc6-ef6a5e819c8e"
  mode="voice"
  theme="dark"
  voice-show-transcript="true"
></vapi-widget>

<script src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js" async></script>

<script>
  let widgetInstance;

  // 1) Wait until widget is ready
  window.addEventListener("vapi-ready", (event) => {
    widgetInstance = event.detail;
    console.log("‚úÖ Vapi widget ready", widgetInstance);
  });

  // 2) Poll your n8n feed every 5 seconds
  async function pollFeed() {
    try {
      const res = await fetch("https://poppasmurf.app.n8n.cloud/webhook-test/tts-feed");
      if (!res.ok) throw new Error("Feed request failed");

      const data = await res.json();
      console.log("üì• OCR Feed Response:", data);

      // Example: your feed returns { id: "...", text: "..." }
      if (data.text && widgetInstance) {
        widgetInstance.send({ type: "input_text", text: data.text });
        console.log("‚û°Ô∏è Sent OCR text into widget:", data.text);
      }
    } catch (err) {
      console.error("Feed polling error:", err);
    }
  }

  // 3) Start polling every 5s
  setInterval(pollFeed, 5000);
</script>
