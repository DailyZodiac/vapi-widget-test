<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ElevenLabs Voice Autoplay + Manual</title>
</head>
<body class="p-6 font-sans">
  <h1>ElevenLabs TTS Demo</h1>
  <textarea id="text" rows="4" cols="50" placeholder="Type text here..."></textarea><br>
  <button id="speak">Speak</button>
  <audio id="player" controls></audio>

  <script>
    const player = document.getElementById("player");
    const textArea = document.getElementById("text");
    const speakButton = document.getElementById("speak");

    // 🔊 Function to talk using ElevenLabs
    async function speakText(text) {
      if (!text.trim()) return;

      const response = await fetch("https://api.elevenlabs.io/v1/text-to-speech/uYXf8XasLslADfZ2MB4u", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "xi-api-key": "a209ada0ca0fdde60a9583f8b36225bb6ee1420c4a9227a12a0bfc012683f465"
        },
        body: JSON.stringify({
          text,
          voice_settings: {
            stability: 0.5,
            similarity_boost: 0.8
          }
        })
      });

      const audioBlob = await response.blob();
      const audioUrl = URL.createObjectURL(audioBlob);
      player.src = audioUrl;
      player.play();
    }

    // 🖱️ Manual Speak Button
    speakButton.addEventListener("click", async () => {
      const text = textArea.value;
      await speakText(text);
    });

    // 🔄 Auto-Speech from n8n
    // Replace this with your actual n8n webhook URL
    const N8N_WEBHOOK_URL = "https://poppasmurf.app.n8n.cloud/webhook/066cea78-1f36-4be1-b11a-3e4befcd7812";

    async function checkForMessage() {
      try {
        const res = await fetch(N8N_WEBHOOK_URL);
        const data = await res.json();

        if (data.message && data.message !== window.lastMessage) {
          window.lastMessage = data.message;
          textArea.value = data.message;
          await speakText(data.message);
        }
      } catch (err) {
        console.error("Error fetching from n8n:", err);
      }

      // Check every 5 seconds
      setTimeout(checkForMessage, 5000);
    }

    // Start checking automatically
    checkForMessage();
  </script>
</body>
</html>
